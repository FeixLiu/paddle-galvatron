#!/bin/bash

# ================================
# 脚本功能：通过 SSH 登录多个主机，执行 nvidia-smi 并显示结果
# 假设使用用户名：ubuntu （请按需修改！）
# 假设已配置 SSH 免密登录（公钥认证），否则脚本会卡住等待输入密码
# ================================

# # 设置 SSH 用户名（按需修改，比如 root / guangming / ubuntu 等）
# USER="ubuntu"

# 定义目标 IP 列表
IP_LIST=(
    "28.12.25.40"
    "28.12.131.55"
    "28.12.130.118"
    "28.12.26.158"
    "28.12.24.8"
    "28.12.25.237"
    "28.12.24.94"
)

# 遍历每个 IP
for IP in "${IP_LIST[@]}"; do
    echo "=============================================="
    echo "正在连接主机: $IP"
    echo "=============================================="

    # 通过 SSH 执行 nvidia-smi 命令
    ssh "$IP" "nvidia-smi"

    echo ""
    echo "----------------------------------------------"
    echo "主机 $IP 的 nvidia-smi 执行完毕"
    echo "----------------------------------------------"
    echo ""
done

echo "✅ 所有主机的 nvidia-smi 检查完成！"